<project name="mPoint" default="deploy" basedir=".">
	<target name="init">
		<property name="version" value="v1.20" />
		<property name="baseDir" value="D:\Temp\mPoint" />
		
		<property name="sourceDir" value="${baseDir}/temp" />
		
		<property name="destDir" value="${baseDir}/${version}" />
		
		<property name="sshDir" value="C:\Program Files (x86)\Network Tools" />
		<property name="svnDir" value="C:\Program Files\TortoiseSVN\bin" />
	</target>

	<target name="clean" depends="init">
		<delete dir="${destDir}" />
	</target>
	
	<target name="prepare" depends="clean">
		<mkdir dir="${destDir}" />
		<mkdir dir="${sourceDir}" />
		<!--	
		<exec dir="${sshDir}" executable="${sshDir}/ssh_node3.sh" spawn="true" />
		
		<sleep seconds="10" />
		-->
		<exec dir="${svnDir}" executable="${svnDir}/TortoiseProc.exe">
			<arg line="export --force --username Jona --password jb280680 svn://localhost/mpoint/trunk ${sourceDir}" />
		</exec>
		
		<copy todir="${destDir}">
			<fileset dir="${sourceDir}" />
		</copy>
	</target>

	<target name="doc" depends="prepare">
		<!-- Generate phpDoc for mPoint in PDF and HTML format
		<get src="http://phpdoc.localhost/default.php?altuserdir=&amp;setting%5Buseconfig%5D=&amp;setting%5Btarget%5D=${sourceDir}%2Fdoc&amp;setting%5Bfilename%5D=D%3A%2Fcydev%2FmPoint%2Fserver%2Fconf%2Fglobal.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Freport.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Fremote_report.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Ftemplate.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Fhttp_client.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Fsession.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Fdatabase.php%2C+D%3A%2Fcydev%2Fphp5api%2Ffunctions%2Fglobal.php%2C+D%3A%2Fcydev%2Fphp5api%2Fconf%2Fglobal.php%2C+D%3A%2Fcydev%2Fphp5api%2Finterfaces%2Fdatabase.php&amp;setting%5Bdirectory%5D=D%3A%2Fcydev%2FmPoint%2Fserver%2Fapi&amp;setting%5Bignore%5D=&amp;setting%5Btitle%5D=mPoint+-+Remote+Debugger&amp;setting%5Bdefaultpackagename%5D=Default&amp;setting%5Bcustomtags%5D=&amp;setting%5Bpackageoutput%5D=&amp;setting%5Boutput%5D=PDF%3Adefault%3Adefault&amp;ConverterSetting=PDF%3Adefault%3Adefault&amp;setting%5Bparseprivate%5D=on&amp;setting%5Bjavadocdesc%5D=on&amp;interface=web&amp;submit=true&amp;submitButton=Create+Documentation"
			 dest="${sourceDir}/doc/${version}.pdf" />
		<move file="${ourceDir}/doc/documentation.pdf" tofile="${serverDestDir}/doc/${version}.pdf" />
		<get src="http://phpdoc.localhost/default.php?altuserdir=&amp;setting%5Buseconfig%5D=&amp;setting%5Btarget%5D=${phpdocDir}%2Fserver&amp;setting%5Bfilename%5D=D%3A%2Fcydev%2FmPoint%2Fserver%2Fserver%2Fconf%2Fglobal.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Freport.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Fremote_report.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Ftemplate.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Fhttp_client.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Fsession.php%2C+D%3A%2Fcydev%2Fphp5api%2Fclasses%2Fdatabase.php%2C+D%3A%2Fcydev%2Fphp5api%2Ffunctions%2Fglobal.php%2C+D%3A%2Fcydev%2Fphp5api%2Fconf%2Fglobal.php%2C+D%3A%2Fcydev%2Fphp5api%2Finterfaces%2Fdatabase.php&amp;setting%5Bdirectory%5D=D%3A%2Fcydev%2FmPoint%2Fserver%2Fapi&amp;setting%5Bignore%5D=&amp;setting%5Btitle%5D=mPoint+-+Remote+Debugger&amp;setting%5Bdefaultpackagename%5D=Default&amp;setting%5Bcustomtags%5D=&amp;setting%5Bpackageoutput%5D=&amp;setting%5Boutput%5D=HTML%3Aframes%3Adefault&amp;ConverterSetting=HTML%3Aframes%3Adefault&amp;setting%5Bparseprivate%5D=on&amp;setting%5Bjavadocdesc%5D=on&amp;interface=web&amp;submit=true&amp;submitButton=Create+Documentation"
			 dest="${sourceDir}/doc/phpdoc.html" />
			 -->
	</target>
	
	<target name="deploy" depends="doc, prepare, init">
		<!-- Cleanup -->
		<delete dir="${sourceDir}" />
		
		<echo level="info">
Automatic deployment complete.
In order to finnish deploying mPoint please upload ${destDir} to the server and the global configuration file: ${destDir}/conf/global.php must be edited to correspond with the server.
Additionally the following .htaccess files must be copied to the server manually using scp if on a Mac.
- ${destDir}/webroot/img/.htaccess
- ${destDir}/webroot/pay/.htaccess
- ${destDir}/webroot/shop/.htaccess
Finally the global include file ${destDir}/webroot/inc/include.php needs to be modified so the API Class paths are correct (generally each path needs to have ../ inserted before the directory) 
		</echo>
	</target>
</project>