<PML_META nospace="true">
<PML_SCRIPT>
/**
 * Page allowing customers to enter their Credit Card Information which is sent securely to DIBS through HTTPS.
 * The page is translated into several languages as defined by mPoint and allows card info to be pre-filled if the 
 * client's account is in test mode.
 *
 * @author Jonatan Evald Buus
 * @package Payment
 * @subpackage DIBS
 * @license Cellpoint Mobile
 */
 
// Payment Gateay is in Test Mode, set default card info
if (cgi.test = 1)
{
	// American Express
	if (cgi.cardid = 1) { sess_cardno := 3700100000000000; }
	// Dankort
	elsif (cgi.cardid = 2) { sess_cardno := 5019100000000000; }
	// Diners Club
	elsif (cgi.cardid = 3) { sess_cardno := 30401000000000; }
	// EuroCard
	elsif (cgi.cardid = 4) { sess_cardno := 5100100000000000; }
	// JCB
	elsif (cgi.cardid = 5) { sess_cardno := 3528100000000000; }
	// Maestro
	elsif (cgi.cardid = 6) { sess_cardno := 5020100000000000; }
	// MasterCard
	elsif (cgi.cardid = 7) { sess_cardno := 5100100000000000; }
	// VISA
	elsif (cgi.cardid = 8) { sess_cardno := 4711100000000000; }
	// VISA Electron
	elsif (cgi.cardid = 9) { sess_cardno := 4711100000000000; }
	// Unknown Card
	else { sess_cardno := ''; }
	sess_expmon := '06';
	sess_expyear := 24;
	sess_cvc := 684;
}

/* ========== Language Translataion Start ========== */
switch(cgi.language)
{
	// Danish
	case ('da')
	{
		title := 'Kort Info';
		progress := 'Trin 2 af 2';
		label_selected_card := 'Valgte kort';
		label_price := 'Pris';
		info := 'Udfyld nedenstående felter med dine kortinformationer';
		label_card_number := 'Kortnummer';
		label_expiry := 'Udløbsdato';
		expiry_month := 'mm';
		expiry_year := 'åå';
		label_cvc := 'CVC / CVS';
		cvc_help := '3 tal (trykt på bagsiden af dit kort)';
		label_store := 'Gem kortinformationer';
		submit := 'Gennemfør betaling';
		label_loading := 'Henter...';
	}
	// Swedish
	case ('sv')
	{
		title := 'Kortinformation';
		progress := 'Steg 2 av 2';
		label_selected_card := 'Valt kort';
		label_price := 'Pris';
		info := 'Vänligen fyll i din kortinformation nedan';
		label_card_number := 'Kortnummer';
		label_expiry := 'Giltighetstid';
		expiry_month := 'mm';
		expiry_year := 'åå';
		label_cvc := 'CVC / CVS';
		cvc_help := '3 siffror (tryckta på baksidan av kortet)';
		label_store := 'Gem kortinformation';
		submit := 'Betalningen genomförd';
		label_loading := 'Loading...';
	}
	// British English
	default
	{
		title := 'Card Info';
		progress := 'Step 2 of 2';
		label_selected_card := 'Selected Card';
		label_price := 'Price';
		info := 'Enter your card information below';
		label_card_number := 'Card Number';
		label_expiry := 'Expiry date';
		expiry_month := 'mm';
		expiry_year := 'yy';
		label_cvc := 'CVC / CVS';
		cvc_help := '3 digits (printed on the back)';
		label_store := 'Save card info';
		submit := 'Complete Payment';
		label_loading := 'Loading...';
	}
}
/* ========== Language Translataion End ========== */

/* ========== Client Customization Start ========== */
switch(cgi.clientid)
{
	// mPoint - System Account (DK)
	case (100)
	{
		background_colour := 'fff';
		border_colour := '8FBFD5';
	}
	// mPoint - System Account (US)
	case (200)
	{
		background_colour := 'fff';
		border_colour := '8FBFD5';
	}
	// mPoint - Mobile Payment Demo (US)
	case (10000)
	{
		background_colour := 'E8E8E8';
		border_colour := '5B94B1';
	}
	// mPoint - Mobile Payment Demo (DK)
	case (10001)
	{
		background_colour := 'E8E8E8';
		border_colour := '5B94B1';
	}
	// Insurance renewal demo
	case (10012)
	{
		background_colour := 'fff';
		border_colour := '000';
	}
	// Other Client
	default
	{
		background_colour := '8FBFD5';
		border_colour := '000';
	}
}
/* ========== Client Customization End ========== */
</PML_SCRIPT>
<PML_SWITCH EXPR="cgi.markup">
<PML_CASE VALUE="'app'">
	<?xml version="1.0" encoding="UTF-8"?>
	<root>
		<url method="post" content-type="application/x-www-form-urlencoded">https://payment.architrade.com/shoppages/<PML_VAL>cgi.merchant</PML_VAL>/auth.pml</url>
		<card_number>cardno</card_number>
		<expiry_month>expmon</expiry_month>
		<expiry_year>expyear</expiry_year>
		<cvc>cvc</cvc>
		<store_card>preauth</store_card>
		<hidden_fields>
			<!-- DIBS Required Data -->
			<PML_IF COND="cgi.test > 0">
				<test><PML_VAL>cgi.test</PML_VAL></test>
			</PML_IF>
			<merchant><PML_VAL>cgi.merchant</PML_VAL></merchant>
			<callbackurl><PML_VAL>string.HTMLencode(cgi.callbackurl)</PML_VAL></callbackurl>
			<amount><PML_VAL>cgi.amount</PML_VAL></amount>
			<currency><PML_VAL>cgi.currency</PML_VAL></currency>
			<orderid><PML_VAL>cgi.orderid</PML_VAL></orderid>
			<PML_IF COND="cgi.capturenow = 'true'">
				<capturenow><PML_VAL>cgi.capturenow</PML_VAL></capturenow>
			</PML_IF>
			<fullreply>true</fullreply>
			<PML_IF COND="cgi.accounts > 0">
				<account><PML_VAL>cgi.accounts</PML_VAL></account>
			</PML_IF>
			<paytype><PML_VAL>cgi.paytype</PML_VAL></paytype>
			<lang><PML_VAL>cgi.lang</PML_VAL></lang>
			<!-- mPoint Required Data -->
			<language><PML_VAL>cgi.language</PML_VAL></language>
			<cardid><PML_VAL>cgi.cardid</PML_VAL></cardid>
			<mpointid><PML_VAL>cgi.mpointid</PML_VAL></mpointid>
			<!-- Current transaction is an Account Top-Up and a previous transaction is in progress -->
			<PML_IF COND="cgi.org_mpointid > 0">
				<org_mpointid><PML_VAL>cgi.org_mpointid</PML_VAL></org_mpointid>
			</PML_IF>
			<euaid><PML_VAL>cgi.euaid</PML_VAL></euaid>
			<!-- Store Credit Card -->
			<PML_IF COND="cgi.store_card > 0">
				<store_card><PML_VAL>cgi.store_card</PML_VAL></store_card>
				<auto_store_card><PML_VAL>cgi.auto_store_card</PML_VAL></auto_store_card>
			</PML_IF>
			<!-- Dynamic Page Data -->
			<clientid><PML_VAL>cgi.clientid</PML_VAL></clientid>
			<accountid><PML_VAL>cgi.accountid</PML_VAL></accountid>
			<markup><PML_VAL>cgi.markup</PML_VAL></markup>
		</hidden_fields>
	</root>
</PML_CASE>
<PML_CASE VALUE="'html5'">
	<!DOCTYPE html>
		<html PML_xml:lang="cgi.lang">
		<title><PML_VAL>title</PML_VAL></title>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-15" />
		<meta http-equiv="Cache-Control" content="max-age=86400" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<style>
			/* ========== Tag Classes Start ========== */
			body
			{
				width: 100%;
				margin: 0px;
				padding: 0px;
				-webkit-user-select: none;
			    -webkit-text-size-adjust: none;
				
			}
			body
			{
				background-color: #e5e8ed;
				text-align: left;
			}
			body, table, div
			{
				font-size: 1em;
				font-family: "Trebuchet MS", arial,sans-serif;
				color: #000;
			}
			
			h1
			{
				font-size: 130%;
				white-space: nowrap;
				text-align: center;
				color: #000;
			}
			h2
			{
				font-size: 110%;
				white-space: nowrap;
				text-align: center;
				color: #fff;
				margin-bottom: 5px;
			}
			
			form, table
			{
				margin: 0px 0px 0px 0px;
				padding: 0px 0px 0px 0px;
			}
			
			a
			{
				color: blue;
				text-decoration: none;
			}
			
			a:hover
			{
				text-decoration: underline;
			}
			
			input.number
			{
				-wap-input-format: '*N';
			}
			ul, ul li
			{
				padding: 0;
				margin: 0;
			}
			ul li
			{
				margin-left: 1em;
			}
			/* ========== Tag Classes End ========== */
			
			/* ========== Input Fields Start ========== */
			input.text 
			{
			    width: 140px;
			}
			input[type="password"] 
			{
			    width: 100px;
			}
			input.control-scroll
			{
				position: relative;
				top: -27px;
				left: 0px;
				width: 172px;
				height: 21px;
				z-index: 1;
				margin: 0px 0px -35px 0px;
				padding: 0px 0px -35px 0px;
				border: none;
			/*	border: 1px solid red; */
				background-color: transparent;
				-webkit-appearance: none;
			}
			.control-scroll
			{
				position: relative;
				top: -25px;
				left: 0px;
				height: 21px;
				margin: 0px 0px -20px 0px;
				z-index: 1;
			}
			.control-scroll input[type="button"]
			{
				position: absolute;
				top: 0px;
				left: 0px;
				width: 172px;
				height: 21px;
				border: none;
				background-color: transparent;
				-webkit-appearance: none;
			}
			.control-focus
			{
				position: relative;
				top: -25px;
				left: 0px;
				height: 35px;
				margin: 0px 0px -35px 0px;
				z-index: 1;
			}
			.control-focus input[type="button"]
			{
				position: absolute;
				top: 0px;
				left: 0px;
				width: 100%;
				height: 35px;
				border: none;
				background-color: transparent;
				-webkit-appearance: none;
			}
			/* ========== Input Fields End ========== */
			
			/* ========== Table List Start ========== */
			table.grouped
			{
				padding-right: 10px;
				width: 100%;
			}
			table.grouped tr th
			{
				white-space: nowrap;
			}
			tr.row, tr.first-row, tr.last-row
			{
				padding: 0px;
				background-color: white;
				height: 45px;
			}
			.stretch
			{
				width: 100%;
			}
			table.grouped tr.row > th, table.grouped tr.first-row > th, table.grouped tr.last-row > th, table.grouped tr.row > td, table.grouped tr.first-row > td, table.grouped tr.last-row > td
			{
				padding-left: 5px;
				border-bottom: 1px solid rgb(217, 217, 217);
			}
			table.grouped tr.combined-row
			{
				height: 22px;
			}
			table.grouped tr.row th.combined-row, table.grouped tr.row td.combined-row, table.grouped tr.first-row th.combined-row, table.grouped tr.first-row td.combined-row
			{
				border-bottom: none;
			}
			
			table.grouped tr.row img, table.grouped tr.first-row img, table.grouped tr.last-row img
			{
				border: none;
				vertical-align: middle;
			}
			table.grouped tr.first-row > th, table.grouped tr.first-row > td
			{
				border-top: 1px solid rgb(217, 217, 217);
			}
			table.grouped tr.last-row > th, table.grouped tr.last-row > td
			{
				
			}
			table.grouped th.left-column, table.grouped td.left-column, table.grouped th.column, table.grouped td.column
			{
				border-left: 1px solid rgb(217, 217, 217);
			}
			table.grouped th.right-column, table.grouped td.right-column
			{
				border-right: 1px solid rgb(217, 217, 217);
				padding-right: 5px;
			}
			table.grouped tr.first-row th.left-column, table.grouped tr.first-row td.left-column
			{
				-moz-border-top-left-radius: 8px;
				-webkit-border-top-left-radius: 8px;
				-o-border-border-top-left-radius: 8px;	
			}
			table.grouped tr.last-row th.left-column, table.grouped tr.last-row td.left-column
			{
				-moz-border-bottom-left-radius: 8px;
				-webkit-border-bottom-left-radius: 8px;
				-o-border-border-bottom-left-radius: 8px;	
			}
			table.grouped tr.first-row th.right-column, table.grouped tr.first-row td.right-column
			{
				-moz-border-top-right-radius: 8px;
				-webkit-border-top-right-radius: 8px;
				-o-border-border-top-right-radius: 8px;	
			}
			table.grouped tr.last-row th.right-column, table.grouped tr.last-row td.right-column
			{
				-moz-border-bottom-right-radius: 8px;
				-webkit-border-bottom-right-radius: 8px;
				-o-border-border-bottom-right-radius: 8px;	
			}
			table.grouped tr.selected, table.grouped th.selected, table.grouped td.selected
			{
				background-color: #015A7D;
				color: #fff;
			}
			table.grouped tr.selected th, table.grouped tr.selected td, table.grouped th.selected, table.grouped td.selected
			{
				color: #fff;
			}
			table.grouped .info
			{
				padding-top: 0px;
				font-style: italic;
				font-size: 90%;
			}
			table.grouped h2
			{
				color: #000;
				font-weight: bold;
				margin: 0px;
			}
			/* ========== Table List End ========== */
			
			/* ========== Large Submit Button Start ========== */
			a.submit-button
			{
				height: 30px;
				width: 200px;
				color: #fff;
				text-decoration: none;
				background: -webkit-gradient(
											linear,
											left top,
											left bottom,
											color-stop(0.00, #86C28C),
											color-stop(0.50, #009F11),
											color-stop(0.51, #009F11),
											color-stop(1.00, #008F0B)
											);
				-moz-border-radius: 10px;
				-webkit-border-radius: 10px;
				-o-border-radius: 10px;
				border-radius: 10px;
				border-top: 1px solid #D0D0D0;
				border-bottom: 2px solid #2A422C;
				border-left: 1px solid #5A5A5C;
				border-right: 2px solid #374139;
				display: block;
				padding: 5px 10px;
				margin: 15px auto;
			}
			a.submit-button h2
			{
				height: 30px;
				width: 200px;
				vertical-align: middle;
				text-align: center;
				display: table-cell;
			}
			a.submit-button-clicked
			{
				opacity: 0.4;
				filter: alpha(opacity=40);
				height: 30px;
				width: 200px;
				color: #374139;
				text-decoration: none;
				-moz-border-radius: 10px;
				-webkit-border-radius: 10px;
				-o-border-radius: 10px;
				border-radius: 10px;
				border-top: 1px solid #D0D0D0;
				border-bottom: 1px solid #2A422C;
				border-left: 1px solid #5A5A5C;
				border-right: 1px solid #374139;
				display: block;
				padding: 5px 10px;
				margin: 15px auto;
			}
			/* ========== Large Button End ========== */
			
			/* ========== Loader Start ========== */
			span#loader
			{
				visibility: hidden;
				position: absolute;
				left: 40%;
				top: 50%;
				width: 50px;
				height: 50px;
				text-align: center;
				color: #000;
				font-size: 10px;
				background-color: #fff;
				border: 2px solid #013C64;
				-moz-border-radius: 10px;
				-webkit-border-radius: 10px;
				border-radius: 10px;
				padding: 5px;
				z-index: 30;
			}
			/* ========== Loader End ========== */
			
			/* ========== Button Start ========== */
			.button
			{
				position: fixed;
				top: 5px;
				right: 20px;
				width: 43px;
				height: 30px;
				margin: 0px 3px;
				border-top: 1px solid #fff;
				border-left: 1px solid #fff;
				border-bottom: 2px solid #494949;
				border-right: 2px solid #494949;
				-moz-border-radius: 4px;
				-webkit-border-radius: 4px;
				-o-border-radius: 4px;
				border-radius: 4px;
				line-height: 30px;
				z-index: 1;
				background: -webkit-gradient(
											linear,
											left top,
											left bottom,
											color-stop(0.00, #3E82FF),
											color-stop(0.50, #1164FF),
											color-stop(0.51, #0052EA),
											color-stop(1.00, #00318C)
											);
				font-weight: bold;
				color: white;
				text-align: center;
			}
			.clicked
			{
				opacity: 0.4;
				filter: alpha(opacity=40);
				border-top: 0px;
				border-left: 0px;
				border-bottom-width: 1px;
				border-right-width: 1px;
			}
			/* ========== Button End ========== */
			
			/* ========== Content Start ========== */
			#wrapper
			{
				width: 100%;
				height: 99%;
				position: relative;
			    z-index: 1;
			    overflow: auto;
			}
			#content
			{
			/*	-webkit-touch-callout: none;
				-webkit-tap-highlight-color: rgba(0, 0, 0, 0); */
				width: 97%;
				position: absolute;
				z-index: 1;
				padding-top: 10px;
				padding-bottom: 5px;
				padding-left: 10px;
			}
			span.hidden-data
			{
				visibility: hidden;
				position: absolute;
				left: 1px;
				top: 1px;
			}
			/* ========== Content End ========== */
			
			/* ========== Checkbox Start ========== */
			.checkbox
			{
				width: 30px;
				height: 30px;
				border: 1px solid #000;
				-moz-border-radius: 10px;
				-webkit-border-radius: 10px;
				-o-border-radius: 10px;
				border-radius: 10px;
				margin: 5px 10px 0px 5px;
			}
			.checkbox img
			{
				visibility: hidden;
			}
			.checkbox-checked img
			{
				visibility: visible;
			}
			/* ========== Checkbox End ========== */
			
			/* ========== mPoint Classes Start ========== */
			.mPoint_Label
			{
				font-weight: bold;
				padding-right: 0.5em;
				white-space: nowrap;
			}
			
			.mPoint_Info
			{
				font-weight: normal;
				color: #000;
				text-align: left;
				padding: 0px;
				margin: 0px;	
			}
			
			.mPoint_Help
			{
				margin-left: 15px;
			}
			table.grouped tr th.mPoint_Help
			{
				white-space: normal;
			}
			.mPoint_Status
			{
				font-size: 90%;
				color: red;
				font-style: italic;
				padding-top: 0.5em;
				padding-bottom: 0.5em;
			}
			div#info .mPoint_Status
			{
				color: darkgreen;
			}
			
			td.mPoint_Number
			{
				padding-right: 0.5em;
				text-align: right;
				white-space: nowrap;
			}
			.mPoint_Card
			{
				width: 50%;
			}
			/* ========== mPoint Classes End ========== */

			/* ========== ID Classes Start ========== */
			div#logo, div#progress
			{
				text-align: center;
			}
			#price
			{
				white-space: nowrap;
			}
			/* ========== ID Classes End ========== */
		</style>
		<script type="text/javascript">
		(function(){
			var m = Math,
				vendor = (/webkit/i).test(navigator.appVersion) ? 'webkit' :
					(/firefox/i).test(navigator.userAgent) ? 'Moz' :
					'opera' in window ? 'O' : '',

				// Browser capabilities
				has3d = 'WebKitCSSMatrix' in window && 'm11' in new WebKitCSSMatrix(),
				hasTouch = 'ontouchstart' in window,
				hasTransform = vendor + 'Transform' in document.documentElement.style,
				isIDevice = (/iphone|ipad/gi).test(navigator.appVersion),
				isPlaybook = (/playbook/gi).test(navigator.appVersion),
				hasTransitionEnd = isIDevice || isPlaybook,
				nextFrame = (function() {
				    return window.requestAnimationFrame
						|| window.webkitRequestAnimationFrame
						|| window.mozRequestAnimationFrame
						|| window.oRequestAnimationFrame
						|| window.msRequestAnimationFrame
						|| function(callback) { return setTimeout(callback, 17); }
				})(),
				cancelFrame = (function () {
				    return window.cancelRequestAnimationFrame
						|| window.webkitCancelRequestAnimationFrame
						|| window.mozCancelRequestAnimationFrame
						|| window.oCancelRequestAnimationFrame
						|| window.msCancelRequestAnimationFrame
						|| clearTimeout
				})(),

				// Events
				RESIZE_EV = 'onorientationchange' in window ? 'orientationchange' : 'resize',
				START_EV = hasTouch ? 'touchstart' : 'mousedown',
				MOVE_EV = hasTouch ? 'touchmove' : 'mousemove',
				END_EV = hasTouch ? 'touchend' : 'mouseup',
				CANCEL_EV = hasTouch ? 'touchcancel' : 'mouseup',

				// Helpers
				trnOpen = 'translate' + (has3d ? '3d(' : '('),
				trnClose = has3d ? ',0)' : ')',

				// Constructor
				iScroll = function (el, options) {
					var that = this,
						doc = document,
						i;

					that.wrapper = typeof el == 'object' ? el : doc.getElementById(el);
					that.wrapper.style.overflow = 'hidden';
					that.scroller = that.wrapper.children[0];

					// Default options
					that.options = {
						hScroll: true,
						vScroll: true,
						bounce: true,
						bounceLock: false,
						momentum: true,
						lockDirection: true,
						useTransform: true,
						useTransition: false,

						// Events
						onRefresh: null,
						onBeforeScrollStart: function (e) { e.preventDefault(); },
						onScrollStart: null,
						onBeforeScrollMove: null,
						onScrollMove: null,
						onBeforeScrollEnd: null,
						onScrollEnd: null,
						onTouchEnd: null,
						onDestroy: null
					};

					// User defined options
					for (i in options) that.options[i] = options[i];

					// Normalize options
					that.options.useTransform = hasTransform ? that.options.useTransform : false;
					that.options.hScrollbar = that.options.hScroll && that.options.hScrollbar;
					that.options.vScrollbar = that.options.vScroll && that.options.vScrollbar;
					that.options.useTransition = hasTransitionEnd && that.options.useTransition;

					// Set some default styles
					that.scroller.style[vendor + 'TransitionProperty'] = that.options.useTransform ? '-' + vendor.toLowerCase() + '-transform' : 'top left';
					that.scroller.style[vendor + 'TransitionDuration'] = '0';
					that.scroller.style[vendor + 'TransformOrigin'] = '0 0';
					if (that.options.useTransition) that.scroller.style[vendor + 'TransitionTimingFunction'] = 'cubic-bezier(0.33,0.66,0.66,1)';
					
					if (that.options.useTransform) that.scroller.style[vendor + 'Transform'] = trnOpen + '0,0' + trnClose;
					else that.scroller.style.cssText += ';top:0;left:0';
							
					that.refresh();

					that._bind(RESIZE_EV, window);
					that._bind(START_EV);
					if (!hasTouch) that._bind('mouseout', that.wrapper);
				};

			// Prototype
			iScroll.prototype = {
				enabled: true,
				x: 0,
				y: 0,
				steps: [],
				scale: 1,
				
				handleEvent: function (e) {
					var that = this;
					switch(e.type) {
						case START_EV: that._start(e); break;
						case MOVE_EV: that._move(e); break;
						case END_EV:
						case CANCEL_EV: that._end(e); break;
						case RESIZE_EV: that._resize(); break;
						case 'mouseout': that._mouseout(e); break;
						case 'webkitTransitionEnd': that._transitionEnd(e); break;
					}
				},

				_resize: function () {
					this.refresh();
				},
				
				_pos: function (x, y) {
					x = this.hScroll ? x : 0;
					y = this.vScroll ? y : 0;

					if (this.options.useTransform) {
						this.scroller.style[vendor + 'Transform'] = trnOpen + x + 'px,' + y + 'px' + trnClose + ' scale(' + this.scale + ')';
					} else {
						x = m.round(x);
						y = m.round(y);
						this.scroller.style.left = x + 'px';
						this.scroller.style.top = y + 'px';
					}

					this.x = x;
					this.y = y;
				},

				_start: function (e) {
					var that = this,
						point = hasTouch ? e.touches[0] : e,
						matrix, x, y;

					if (!that.enabled) return;

					if (that.options.onBeforeScrollStart) that.options.onBeforeScrollStart.call(that, e);
					
					if (that.options.useTransition) that._transitionTime(0);

					that.moved = false;
					that.animating = false;
					that.zoomed = false;
					that.distX = 0;
					that.distY = 0;
					that.absDistX = 0;
					that.absDistY = 0;
					that.dirX = 0;
					that.dirY = 0;

					if (that.options.momentum) {
						if (that.options.useTransform) {
							// Very lame general purpose alternative to CSSMatrix
							matrix = getComputedStyle(that.scroller, null)[vendor + 'Transform'].replace(/[^0-9-.,]/g, '').split(',');
							x = matrix[4] * 1;
							y = matrix[5] * 1;
						} else {
							x = getComputedStyle(that.scroller, null).left.replace(/[^0-9-]/g, '') * 1;
							y = getComputedStyle(that.scroller, null).top.replace(/[^0-9-]/g, '') * 1;
						}
						
						if (x != that.x || y != that.y) {
							if (that.options.useTransition) that._unbind('webkitTransitionEnd');
							else cancelFrame(that.aniTime);
							that.steps = [];
							that._pos(x, y);
						}
					}

					that.absStartX = that.x;	// Needed by snap threshold
					that.absStartY = that.y;

					that.startX = that.x;
					that.startY = that.y;
					that.pointX = point.pageX;
					that.pointY = point.pageY;

					that.startTime = e.timeStamp || (new Date()).getTime();

					if (that.options.onScrollStart) that.options.onScrollStart.call(that, e);

					that._bind(MOVE_EV);
					that._bind(END_EV);
					that._bind(CANCEL_EV);
				},
				
				_move: function (e) {
					var that = this,
						point = hasTouch ? e.touches[0] : e,
						deltaX = point.pageX - that.pointX,
						deltaY = point.pageY - that.pointY,
						newX = that.x + deltaX,
						newY = that.y + deltaY,
						timestamp = e.timeStamp || (new Date()).getTime();

					if (that.options.onBeforeScrollMove) that.options.onBeforeScrollMove.call(that, e);

					that.pointX = point.pageX;
					that.pointY = point.pageY;

					// Slow down if outside of the boundaries
					if (newX > 0 || newX < that.maxScrollX) {
						newX = that.options.bounce ? that.x + (deltaX / 2) : newX >= 0 || that.maxScrollX >= 0 ? 0 : that.maxScrollX;
					}
					if (newY > 0 || newY < that.maxScrollY) { 
						newY = that.options.bounce ? that.y + (deltaY / 2) : newY >= 0 || that.maxScrollY >= 0 ? 0 : that.maxScrollY;
					}

					if (that.absDistX < 6 && that.absDistY < 6) {
						that.distX += deltaX;
						that.distY += deltaY;
						that.absDistX = m.abs(that.distX);
						that.absDistY = m.abs(that.distY);

						return;
					}

					// Lock direction
					if (that.options.lockDirection) {
						if (that.absDistX > that.absDistY + 5) {
							newY = that.y;
							deltaY = 0;
						} else if (that.absDistY > that.absDistX + 5) {
							newX = that.x;
							deltaX = 0;
						}
					}

					that.moved = true;
					that._pos(newX, newY);
					that.dirX = deltaX > 0 ? -1 : deltaX < 0 ? 1 : 0;
					that.dirY = deltaY > 0 ? -1 : deltaY < 0 ? 1 : 0;

					if (timestamp - that.startTime > 300) {
						that.startTime = timestamp;
						that.startX = that.x;
						that.startY = that.y;
					}
					
					if (that.options.onScrollMove) that.options.onScrollMove.call(that, e);
				},
				
				_end: function (e) {
					if (hasTouch && e.touches.length != 0) return;

					var that = this,
						point = hasTouch ? e.changedTouches[0] : e,
						target, ev,
						momentumX = { dist:0, time:0 },
						momentumY = { dist:0, time:0 },
						duration = (e.timeStamp || (new Date()).getTime()) - that.startTime,
						newPosX = that.x,
						newPosY = that.y,
						newDuration;

					that._unbind(MOVE_EV);
					that._unbind(END_EV);
					that._unbind(CANCEL_EV);

					if (that.options.onBeforeScrollEnd) that.options.onBeforeScrollEnd.call(that, e);

					if (!that.moved) {
						if (hasTouch) {
							// Find the last touched element
							target = point.target;
							while (target.nodeType != 1) target = target.parentNode;

							if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA') {
								ev = document.createEvent('MouseEvents');
								ev.initMouseEvent('click', true, true, e.view, 1,
									point.screenX, point.screenY, point.clientX, point.clientY,
									e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,
									0, null);
								ev._fake = true;
								target.dispatchEvent(ev);
							}
						}

						that._resetPos(200);

						if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);
						return;
					}

					if (duration < 300 && that.options.momentum) {
						momentumX = newPosX ? that._momentum(newPosX - that.startX, duration, -that.x, that.scrollerW - that.wrapperW + that.x, that.options.bounce ? that.wrapperW : 0) : momentumX;
						momentumY = newPosY ? that._momentum(newPosY - that.startY, duration, -that.y, (that.maxScrollY < 0 ? that.scrollerH - that.wrapperH + that.y : 0), that.options.bounce ? that.wrapperH : 0) : momentumY;

						newPosX = that.x + momentumX.dist;
						newPosY = that.y + momentumY.dist;

			 			if ((that.x > 0 && newPosX > 0) || (that.x < that.maxScrollX && newPosX < that.maxScrollX)) momentumX = { dist:0, time:0 };
			 			if ((that.y > 0 && newPosY > 0) || (that.y < that.maxScrollY && newPosY < that.maxScrollY)) momentumY = { dist:0, time:0 };
					}

					if (momentumX.dist || momentumY.dist) {
						newDuration = m.max(m.max(momentumX.time, momentumY.time), 10);

						that.scrollTo(newPosX, newPosY, newDuration);

						if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);
						return;
					}

					that._resetPos(200);
					if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);
				},
				
				_resetPos: function (time) {
					var that = this,
						resetX = that.x >= 0 ? 0 : that.x < that.maxScrollX ? that.maxScrollX : that.x,
						resetY = that.y >= 0 || that.maxScrollY > 0 ? 0 : that.y < that.maxScrollY ? that.maxScrollY : that.y;

					if (resetX == that.x && resetY == that.y) {
						if (that.moved) {
							if (that.options.onScrollEnd) that.options.onScrollEnd.call(that);		// Execute custom code on scroll end
							that.moved = false;
						}

						return;
					}

					that.scrollTo(resetX, resetY, time || 0);
				},
				
				_mouseout: function (e) {
					var t = e.relatedTarget;

					if (!t) {
						this._end(e);
						return;
					}

					while (t = t.parentNode) if (t == this.wrapper) return;
					
					this._end(e);
				},

				_transitionEnd: function (e) {
					var that = this;

					if (e.target != that.scroller) return;

					that._unbind('webkitTransitionEnd');
					
					that._startAni();
				},

				/**
				 *
				 * Utilities
				 *
				 */
				_startAni: function () {
					var that = this,
						startX = that.x, startY = that.y,
						startTime = (new Date).getTime(),
						step, easeOut;

					if (that.animating) return;

					if (!that.steps.length) {
						that._resetPos(400);
						return;
					}

					step = that.steps.shift();

					if (step.x == startX && step.y == startY) step.time = 0;

					that.animating = true;
					that.moved = true;

					if (that.options.useTransition) {
						that._transitionTime(step.time);
						that._pos(step.x, step.y);
						that.animating = false;
						if (step.time) that._bind('webkitTransitionEnd');
						else that._resetPos(0);
						return;
					}

					(function animate () {
						var now = (new Date).getTime(),
							newX, newY;

						if (now >= startTime + step.time) {
							that._pos(step.x, step.y);
							that.animating = false;
							if (that.options.onAnimationEnd) that.options.onAnimationEnd.call(that);			// Execute custom code on animation end
							that._startAni();
							return;
						}

						now = (now - startTime) / step.time - 1;
						easeOut = m.sqrt(1 - now * now);
						newX = (step.x - startX) * easeOut + startX;
						newY = (step.y - startY) * easeOut + startY;
						that._pos(newX, newY);
						if (that.animating) that.aniTime = nextFrame(animate);
					})();
				},

				_transitionTime: function (time) {
					this.scroller.style[vendor + 'TransitionDuration'] = time + 'ms';
				},
				
				_momentum: function (dist, time, maxDistUpper, maxDistLower, size) {
					var deceleration = 0.0006,
						speed = m.abs(dist) / time,
						newDist = (speed * speed) / (2 * deceleration),
						newTime = 0, outsideDist = 0;

					// Proportinally reduce speed if we are outside of the boundaries 
					if (dist > 0 && newDist > maxDistUpper) {
						outsideDist = size / (6 / (newDist / speed * deceleration));
						maxDistUpper = maxDistUpper + outsideDist;
						speed = speed * maxDistUpper / newDist;
						newDist = maxDistUpper;
					} else if (dist < 0 && newDist > maxDistLower) {
						outsideDist = size / (6 / (newDist / speed * deceleration));
						maxDistLower = maxDistLower + outsideDist;
						speed = speed * maxDistLower / newDist;
						newDist = maxDistLower;
					}

					newDist = newDist * (dist < 0 ? -1 : 1);
					newTime = speed / deceleration;

					return { dist: newDist, time: m.round(newTime) };
				},

				_offset: function (el) {
					var left = -el.offsetLeft,
						top = -el.offsetTop;
						
					while (el = el.offsetParent) {
						left -= el.offsetLeft;
						top -= el.offsetTop;
					} 

					return { left: left, top: top };
				},

				_bind: function (type, el, bubble) {
					(el || this.scroller).addEventListener(type, this, !!bubble);
				},

				_unbind: function (type, el, bubble) {
					(el || this.scroller).removeEventListener(type, this, !!bubble);
				},


				/**
				 *
				 * Public methods
				 *
				 */
				destroy: function () {
					var that = this;

					that.scroller.style[vendor + 'Transform'] = '';

					// Remove the event listeners
					that._unbind(RESIZE_EV, window);
					that._unbind(START_EV);
					that._unbind(MOVE_EV);
					that._unbind(END_EV);
					that._unbind(CANCEL_EV);
					that._unbind('mouseout', that.wrapper);
					if (that.options.useTransition) that._unbind('webkitTransitionEnd');
					
					if (that.options.onDestroy) that.options.onDestroy.call(that);
				},

				refresh: function () {
					var that = this,
						offset;

					that.wrapperW = that.wrapper.clientWidth;
					that.wrapperH = that.wrapper.clientHeight;

					that.scrollerW = that.scroller.offsetWidth;
					that.scrollerH = that.scroller.offsetHeight;
					that.maxScrollX = that.wrapperW - that.scrollerW;
					that.maxScrollY = that.wrapperH - that.scrollerH;
					that.dirX = 0;
					that.dirY = 0;
			//alert(that.scroller.getAttribute("id") +": "+ that.wrapperH +" - "+ that.scrollerH +" = "+ that.maxScrollY);
					that.hScroll = that.options.hScroll && that.maxScrollX < 0;
					that.vScroll = that.options.vScroll && (!that.options.bounceLock && !that.hScroll || that.scrollerH > that.wrapperH);

					offset = that._offset(that.wrapper);
					that.wrapperOffsetLeft = -offset.left;
					that.wrapperOffsetTop = -offset.top;


					that.scroller.style[vendor + 'TransitionDuration'] = '0';

					that._resetPos(200);
				},

				scrollTo: function (x, y, time, relative) {
					var that = this,
						step = x,
						i, l;

					that.stop();

					if (!step.length) step = [{ x: x, y: y, time: time, relative: relative }];
					
					for (i=0, l=step.length; i<l; i++) {
						if (step[i].relative) { step[i].x = that.x - step[i].x; step[i].y = that.y - step[i].y; }
						that.steps.push({ x: step[i].x, y: step[i].y, time: step[i].time || 0 });
					}

					that._startAni();
				},

				scrollToElement: function (el, time) {
					var that = this, pos;
					el = el.nodeType ? el : that.scroller.querySelector(el);
					if (!el) return;

					pos = that._offset(el);
					pos.left += that.wrapperOffsetLeft;
					pos.top += that.wrapperOffsetTop;

					pos.left = pos.left > 0 ? 0 : pos.left < that.maxScrollX ? that.maxScrollX : pos.left;
					pos.top = pos.top > 0 ? 0 : pos.top < that.maxScrollY ? that.maxScrollY : pos.top;
					time = time === undefined ? m.max(m.abs(pos.left)*2, m.abs(pos.top)*2) : time;

					that.scrollTo(pos.left, pos.top, time);
				},

				disable: function () {
					this.stop();
					this._resetPos(0);
					this.enabled = false;

					// If disabled after touchstart we make sure that there are no left over events
					this._unbind(MOVE_EV);
					this._unbind(END_EV);
					this._unbind(CANCEL_EV);
				},
				
				enable: function () {
					this.enabled = true;
				},
				
				stop: function () {
					cancelFrame(this.aniTime);
					this.steps = [];
					this.moved = false;
					this.animating = false;
				}
			};

			if (typeof exports !== 'undefined') exports.iScroll = iScroll;
			else window.iScroll = iScroll;

			})();
		</script>
		<style>
			body
			{
				height: <PML_VAL>cgi.device_height - 55</PML_VAL>px;
			}
		</style>
		<script type="text/javascript">
				var myScroll;
				function toggleCheckmark(obj_This)
				{
					if (obj_This.className.match("checkbox-checked") == null)
					{
						obj_This.className += ' checkbox-checked';
					}
					else
					{
						obj_This.className = obj_This.className.replace(" checkbox-checked", "");
						obj_This.className = obj_This.className.replace("checkbox-checked", "");
					}
					if (document.getElementById('preauth').value == 'true') { document.getElementById('preauth').value = 'false'; }
					else { document.getElementById('preauth').value = 'true'; }
				}
				function loadScroll()
				{
					document.addEventListener('touchmove', function(e) { e.preventDefault(); }, false);
					if (myScroll == null)
					{
						myScroll = new iScroll('wrapper', { // checkDOMChanges:false,
//															snap:false,
//															momentum:true,
//															hScrollbar:false,
//															vScrollbar:true,
															useTransform:false,
															onBeforeScrollStart: function (e)
															{
																var target = e.target;
																while (target.nodeType != 1)
																{
																	target = target.parentNode;
																}
																try
																{
																	switch (target.tagName.toLowerCase() )
																	{
																	case "select":
																	case "input":
																	case "textarea":
//																		e.stopPropagation();
																		break;
																	default:
																		e.preventDefault();
																		break;
																	}
																}
																catch (ignore) { /* Ignore */ }
															}
				                                           });
					}
				}
				document.addEventListener('DOMContentLoaded', loadScroll, false);
			</script>
	</head>
	<body>
		<PML_IF COND="cgi.logo_url != ''">
			<div id="logo">
				<img PML_src="'images/client_logo_'@cgi.clientid@'.jpg'" PML_width="cgi.logo_width" PML_height="cgi.logo_height" PML_alt="'- '@cgi.client@' -'" />
			</div>
		</PML_IF>
		<div id="progress" class="mPoint_Info"><PML_VAL>progress</PML_VAL></div>
		
		<div id="wrapper">
			<div id="content">
				<form id="pay-card" action="auth.pml" method="post" onsubmit="javascript:document.getElementById('loader').style.visibility='visible'; document.getElementById('pay').disabled=true;">
					<div>
						<PML_IF COND="cgi.test > 0">
							<input type="hidden" name="test" PML_value="cgi.test" />
						</PML_IF>
						<!-- DIBS Required Data -->
						<input type="hidden" name="merchant" PML_value="cgi.merchant" />
						<input type="hidden" name="callbackurl" PML_value="string.HTMLencode(cgi.callbackurl)" />
						<input type="hidden" name="accepturl" PML_value="string.HTMLencode(cgi.accepturl)" />
						<input type="hidden" name="amount" PML_value="cgi.amount" />
						<input type="hidden" name="currency" PML_value="cgi.currency" />
						<input type="hidden" name="orderid" PML_value="cgi.orderid" />
						<input type="hidden" name="fullreply" value="true" />
						<PML_IF COND="cgi.capturenow = 'true'">
							<input type="hidden" name="capturenow" PML_value="cgi.capturenow" />
						</PML_IF>
						<PML_IF COND="cgi.accounts > 0">
							<input type="hidden" name="account" PML_value="cgi.accounts" />
						</PML_IF>			
						<input type="hidden" name="lang" PML_value="cgi.lang" />
						<input type="hidden" name="paytype" PML_value="cgi.paytype" />
						<input type="hidden" id="preauth" name="preauth" value="false" />
						<!-- mPoint Required Data -->
						<input type="hidden" name="device_name" PML_value="cgi.device_name" />
						<input type="hidden" name="device_width" PML_value="cgi.device_width" />
						<input type="hidden" name="device_height" PML_value="cgi.device_height" />
						<input type="hidden" name="logo_url" PML_value="cgi.logo_url" />
						<input type="hidden" name="logo_width" PML_value="cgi.logo_width" />
						<input type="hidden" name="logo_height" PML_value="cgi.logo_height" />
						<input type="hidden" name="format" PML_value="cgi.format" />
						<input type="hidden" name="PHPSESSID" PML_value="cgi.PHPSESSID" />
						<input type="hidden" name="language" PML_value="cgi.language" />
						<input type="hidden" name="cardid" PML_value="cgi.cardid" />
						<input type="hidden" name="mpointid" PML_value="cgi.mpointid" />
						<input type="hidden" name="markup" PML_value="cgi.markup" />
						<!-- Current transaction is an Account Top-Up and a previous transaction is in progress -->
						<PML_IF COND="cgi.org_mpointid > 0">
							<input type="hidden" name="org_mpointid" PML_value="cgi.org_mpointid" />
						</PML_IF>
						<input type="hidden" name="euaid" PML_value="cgi.euaid" />
						<!-- Store Credit Card -->
						<PML_IF COND="cgi.store_card > 0">
							<input type="hidden" name="store_card" PML_value="cgi.store_card" />
							<input type="hidden" name="auto_store_card" PML_value="cgi.auto_store_card" />
						</PML_IF>
						<!-- Dynamic Page Data -->
						<input type="hidden" name="clientid" PML_value="cgi.clientid" />
						<input type="hidden" name="client" PML_value="cgi.client" />
						<input type="hidden" name="mpoint_width" PML_value="cgi.mpoint_width" />
						<input type="hidden" name="mpoint_height" PML_value="cgi.mpoint_height" />
						<input type="hidden" name="sms_receipt" PML_value="cgi.sms_receipt" />
						<input type="hidden" name="email_receipt" PML_value="cgi.email_receipt" />
						<input type="hidden" name="email_url" PML_value="cgi.email_url" />
						<input type="hidden" name="accept_url" PML_value="cgi.accept_url" />
						<input type="hidden" name="mobile" PML_value="cgi.mobile" />
						<input type="hidden" name="price" PML_value="cgi.price" />
						<input type="hidden" name="card_width" PML_value="cgi.card_width" />
						<input type="hidden" name="card_height" PML_value="cgi.card_height" />
						<PML_SCRIPT>
						// Transfer Custom Variables
						foreach(i ; cgi)
						{
							if (string.substring(cgi[i], 0, 4) = 'var_')
							{
								out.put('<input type="hidden" name="client_vars_names_'@ i @'" value="'@ cgi[i] @'" />');
								out.put('<input type="hidden" name="client_vars_data_'@ i @'" value="'@ cgi[i-7] @'" />');
							}
						}
						</PML_SCRIPT>
					</div>
					<div>
					<table cellpadding="0" cellspacing="0" class="grouped">
					<tr>
						<th colspan="3" class="mPoint_Help"><PML_VAL>label_selected_card</PML_VAL></th>
					</tr>
					<tr class="first-row last-row">
						<td colspan="3" class="left-column right-column stretch">
						<table cellpadding="0" cellspacing="0" class="grouped">
						<tr>
							<PML_SWITCH EXPR="cgi.cardid">
								<PML_CASE VALUE="1">
									<td><img src="images/amex.jpg" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- American Express -" />&nbsp;</td>
									<td class="mPoint_Card">American Express</td>
								</PML_CASE>
								<PML_CASE VALUE="2">
									<td><img src="images/dankort.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Dankort -" />&nbsp;</td>
									<td class="mPoint_Card">Dankort</td>
								</PML_CASE>
								<PML_CASE VALUE="3">
									<td><img src="images/diners.jpg" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Diners Club -" />&nbsp;</td>
									<td class="mPoint_Card">Diners Club</td>
								</PML_CASE>
								<PML_CASE VALUE="4">
									<td><img src="images/mastercard.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- EuroCard -" />&nbsp;</td>
									<td class="mPoint_Card">EuroCard</td>
								</PML_CASE>
								<PML_CASE VALUE="5">
									<td><img src="images/jcb.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- JCB -" />&nbsp;</td>
									<td class="mPoint_Card">JCB</td>
								</PML_CASE>
								<PML_CASE VALUE="6">
									<td><img src="images/maestro.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Maestro -" />&nbsp;</td>
									<td class="mPoint_Card">Maestro</td>
								</PML_CASE>
								<PML_CASE VALUE="7">
									<td><img src="images/mastercard.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- MasterCard -" />&nbsp;</td>
									<td class="mPoint_Card">MasterCard</td>
								</PML_CASE>
								<PML_CASE VALUE="8">
									<td><img src="images/visa.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- VISA -" />&nbsp;</td>
									<td class="mPoint_Card">VISA</td>
								</PML_CASE>
								<PML_CASE VALUE="9">
									<td><img src="images/visa_electron.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- VISA Electron -" />&nbsp;</td>
									<td class="mPoint_Card">VISA Electron</td>
								</PML_CASE>
							</PML_SWITCH>
							</td>
							<td id="price">
								<div class="mPoint_Label"><PML_VAL>label_price</PML_VAL>:</div>
								<PML_VAL>cgi.price</PML_VAL>
							</td>
						</tr>
						</table>
					</tr>
					<tr>
						<td colspan="3"><br /></td>
					</tr>
					<tr>
						<th colspan="3" class="mPoint_Help"><PML_VAL>info</PML_VAL></th>
					</tr>
					<tr class="first-row">
						<th class="left-column"><PML_VAL>label_card_number</PML_VAL>:</th>
						<td colspan="2" class="right-column stretch">
							<PML_IF COND="sess_cardno > 0">
								<input name="cardno" type="number" class="text" maxlength="19" PML_value="string.precision(sess_cardno, 0)" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
							</PML_IF>
							<PML_ELSE>
								<input name="cardno" type="number" class="text" maxlength="19" value="" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
							</PML_ELSE>
						</td>
					</tr>
					<tr class="row">
						<th class="left-column">
							<PML_VAL>label_expiry</PML_VAL>:
							<div class="mPoint_Info">(<PML_VAL>expiry_month</PML_VAL>/<PML_VAL>expiry_year</PML_VAL>)</div>
						</th>
						<td colspan="2" class="right-column stretch">
							<PML_IF COND="sess_expmon > 0">
								<input name="expmon" type="number" maxlength="2" PML_value="string.precision(sess_expmon, 0)" size="3" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
							</PML_IF>
							<PML_ELSE>
								<input name="expmon" type="number" maxlength="2" value="" size="3" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" />
							</PML_ELSE>
							&nbsp;/&nbsp;
							<PML_IF COND="sess_expyear > 0">
								<input name="expyear" type="number" maxlength="2" PML_value="string.precision(sess_expyear, 0)" size="3" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
							</PML_IF>
							<PML_ELSE>
								<input name="expyear" type="number" maxlength="2" value="" size="3" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
							</PML_ELSE>
						</td>
					</tr>
					<tr class="row combined-row">
						<th class="left-column combined-row"><PML_VAL>label_cvc</PML_VAL>:</th>
						<td colspan="2" class="right-column combined-row stretch">
							<PML_IF COND="sess_cvc > 0">
								<input name="cvc" type="number" maxlength="3" PML_value="string.precision(sess_cvc, 0)" size="4" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
							</PML_IF>
							<PML_ELSE>
								<input name="cvc" type="number" maxlength="3" value="" size="4" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
							</PML_ELSE>
						</td>
					</tr>
					<tr class="last-row combined-row">
						<td colspan="3" class="left-column right-column info stretch"><PML_VAL>cvc_help</PML_VAL></td>
					</tr>
					<!-- Store Credit Card -->
					<PML_IF COND="cgi.store_card > 0">
					<tr>
						<td colspan="3">
						<table cellpadding="0" cellspacing="0">
						<tr>
							<td>
								<div id="store-card" class="checkbox" onclick="javascript:toggleCheckmark(this);">
									<img src="images/checkmark.png" width="30" height="30" alt="" />
								</div>
							</td>
							<td class="stretch"><PML_VAL>label_store</PML_VAL></td>
						</tr>
						</table>
						</td>
					</tr>
					</table>
					</PML_IF>
					<!-- Complete Payment -->
					<div id="submit">
						<a id="pay" class="submit-button" onclick="javascript:document.getElementById('loader').style.visibility='visible'; this.className='submit-button-clicked'; this.disabled=true; document.getElementById('pay-card').submit();">
							<h2><PML_VAL>submit</PML_VAL></h2>
						</a>
					</div>
				</form>
			</div>
		</div>
		<!-- Hidden Data Fields Start -->
		<span id="loader">
			<img src="images/loader.gif" width="28" height="28" PML_alt="'- '@label_loading@' -'" border="0" />
			<br />
			<span><PML_VAL>label_loading</PML_VAL></span>
		</span>
		<script type="text/javascript">
			<PML_IF COND="cgi.auto_store_card = 'true'">
				toggleCheckmark(document.getElementById('store-card') );
			</PML_IF>
			parent.postMessage('mpoint-card-details,<PML_VAL>cgi.PHPSESSID</PML_VAL>', '*');
		</script>
	</body>
	</html>
</PML_CASE>
<PML_DEFAULT>
	<?xml version="1.0" encoding="ISO-8859-15"?>
	<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.openmobilealliance.org/DTD/xhtml-mobile10.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml" PML_xml:lang="cgi.lang">
	<title><PML_VAL>title</PML_VAL></title>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-15" />
	<meta http-equiv="Cache-Control" content="max-age=86400" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<style type="text/css">
		/* ========== Tag Classes Start ========== */
		body
		{
			margin: 0px;
		}
		body, table
		{
			background-color: #<PML_VAL>background_colour</PML_VAL>;
			text-align: left;
		}
		body, table, div
		{
			font-size: 1em;
			font-family: "Trebuchet MS",arial,sans-serif;
			color: #000;
		}
		div#content
		{
			margin: 10px 0px 10px 10px;
		}
		table, table * div, table * .mPoint_Info
		{
			color: #000;
		}
		div#status table, div#status table * div, div#status table * .mPoint_Info
		{
			color: #000;
		}
		
		h1
		{
			font-size: 130%;
			white-space: nowrap;
			text-align: center;
			color: #000;
		}
		
		form, table
		{
			margin: 0px 0px 0px 0px;
			padding: 0px 0px 0px 0px;
			text-align: left;
		}
		
		a
		{
			color: blue;
			text-decoration: none;
		}
		
		a:hover
		{
			text-decoration: underline;
		}
		
		input.number
		{
			-wap-input-format: '*N';
		}
		/* ========== Tag Classes End ========== */
		
		/* ========== mPoint Classes Start ========== */
		.mPoint_Label
		{
			font-weight: bold;
			padding-right: 0.5em;
			padding-top: 0.3em;
			white-space: nowrap;
			text-align: left;
		}
		
		.mPoint_Info
		{
			font-weight: normal;
			font-style: italic;
			color: #000;
			text-align: left;
			padding: 0px;
			margin: 0px;	
		}
		
		.mPoint_Status
		{
			color: red;
			font-style: italic;
			padding-top: 0.5em;
			padding-bottom: 0.5em;
		}
		.mPoint_Help
		{
			text-align: center;
			padding-bottom: 5px;
		}
		
		td.mPoint_Number
		{
			padding-right: 0.5em;
			text-align: right;
			vertical-align: bottom;
		}
		
		tr.mPoint_Even
		{
			background-color: #<PML_VAL>background_colour</PML_VAL>;
		}
		tr.mPoint_Uneven
		{
		}
		
		input.mPoint_Button
		{
			font-size: 1em;
			font-weight: bold;
			color: #000;
		}
		
		input.mPoint_Card_Button
		{
			border-style: none;
			background-color: #fff;
			color: blue;
			text-decoration: underline;
			margin: 0px 0px 0px 0px;
			padding: 0px 0px 2px 0px;
		}
		/* ========== mPoint Classes Start ========== */
		
		/* ========== ID Classes Start ========== */
		table#products tr td
		{
			padding-left: 3px;
			padding-top: 3px;
		}
		
		table#receipt
		{
			background-color: #<PML_VAL>background_colour</PML_VAL>;
			margin-top: 0.5em;
			margin-bottom: 0.5em;
		}
		
		div#logo, div#progress, div#mPoint, div#status
		{
			text-align: center;
		}
		
		div#status table tr td
		{
			vertical-align: middle;
			padding-left: 0.5em;
		}
		
		div#terms
		{
			white-space: pre;
		}
		
		div#delivery, table#shipping, div#email, div#cardinfo, div#accountinfo
		{
			background-color: #<PML_VAL>background_colour</PML_VAL>;
			padding-left: 3px;
			padding-bottom: 3px;
			color: #000;
		}
		div#cardinfo .mPoint_Info, div#cardinfo * .mPoint_Info, div#cardinfo .mPoint_Label
		{
			color: #000;
		}

		div#price
		{
			 padding-bottom: 0.5em;
		}
		div#cardinfo
		{
			background-color: #<PML_VAL>background_colour</PML_VAL>;
			padding-left: 10px;
			padding-top: 2px;
			padding-bottom: 5px;
			margin-right: 10px;
			color: #000;
			border: 2px solid #<PML_VAL>border_colour</PML_VAL>;
			-moz-border-radius: 10px;
			-webkit-border-radius: 10px;
			border-radius: 10px;
		}
		div#submit
		{
			text-align: center;
		}
		/* ========== ID Classes End ========== */

		/* ========== Loader Start ========== */
		span#loader
		{
			visibility: hidden;
			position: absolute;
			left: 40%;
			top: 50%;
			width: 50px;
			height: 50px;
			text-align: center;
			color: #000;
			font-size: 10px;
			background-color: #fff;
			border: 2px solid #<PML_VAL>border_colour</PML_VAL>;
			-moz-border-radius: 10px;
			-webkit-border-radius: 10px;
			border-radius: 10px;
			padding: 5px;
			z-index: 30;
		}
		/* ========== Loader End ========== */
	</style>
</head>
<body>
	<PML_IF COND="cgi.logo_url != ''">
		<div id="logo">
			<img PML_src="'images/client_logo_'@cgi.clientid@'.jpg'" PML_width="cgi.logo_width" PML_height="cgi.logo_height" PML_alt="'- '@cgi.client@' -'" />
		</div>
	</PML_IF>
	<div id="progress" class="mPoint_Info"><PML_VAL>progress</PML_VAL></div>
	
	<div id="wrapper">
		<div id="content">
			<form action="auth.pml" method="post">
				<div>
					<PML_IF COND="cgi.test > 0">
						<input type="hidden" name="test" PML_value="cgi.test" />
					</PML_IF>
					<!-- DIBS Required Data -->
					<input type="hidden" name="merchant" PML_value="cgi.merchant" />
					<input type="hidden" name="callbackurl" PML_value="string.HTMLencode(cgi.callbackurl)" />
					<input type="hidden" name="accepturl" PML_value="string.HTMLencode(cgi.accepturl)" />
					<input type="hidden" name="amount" PML_value="cgi.amount" />
					<input type="hidden" name="currency" PML_value="cgi.currency" />
					<input type="hidden" name="orderid" PML_value="cgi.orderid" />
					<input type="hidden" name="fullreply" value="true" />
					<PML_IF COND="cgi.capturenow = 'true'">
						<input type="hidden" name="capturenow" PML_value="cgi.capturenow" />
					</PML_IF>
					<PML_IF COND="cgi.accounts > 0">
						<input type="hidden" name="account" PML_value="cgi.accounts" />
					</PML_IF>			
					<input type="hidden" name="lang" PML_value="cgi.lang" />
					<input type="hidden" name="paytype" PML_value="cgi.paytype" />
					<!-- mPoint Required Data -->
					<input type="hidden" name="device_name" PML_value="cgi.device_name" />
					<input type="hidden" name="device_width" PML_value="cgi.device_width" />
					<input type="hidden" name="device_height" PML_value="cgi.device_height" />
					<input type="hidden" name="logo_url" PML_value="cgi.logo_url" />
					<input type="hidden" name="logo_width" PML_value="cgi.logo_width" />
					<input type="hidden" name="logo_height" PML_value="cgi.logo_height" />
					<input type="hidden" name="format" PML_value="cgi.format" />
					<input type="hidden" name="PHPSESSID" PML_value="cgi.PHPSESSID" />
					<input type="hidden" name="language" PML_value="cgi.language" />
					<input type="hidden" name="cardid" PML_value="cgi.cardid" />
					<input type="hidden" name="mpointid" PML_value="cgi.mpointid" />
					<input type="hidden" name="markup" PML_value="cgi.markup" />
					<!-- Current transaction is an Account Top-Up and a previous transaction is in progress -->
					<PML_IF COND="cgi.org_mpointid > 0">
						<input type="hidden" name="org_mpointid" PML_value="cgi.org_mpointid" />
					</PML_IF>
					<input type="hidden" name="euaid" PML_value="cgi.euaid" />
					<!-- Store Credit Card -->
					<PML_IF COND="cgi.store_card > 0">
						<input type="hidden" name="store_card" PML_value="cgi.store_card" />
						<input type="hidden" name="auto_store_card" PML_value="cgi.auto_store_card" />
					</PML_IF>
					<!-- Dynamic Page Data -->
					<input type="hidden" name="clientid" PML_value="cgi.clientid" />
					<input type="hidden" name="client" PML_value="cgi.client" />
					<input type="hidden" name="mpoint_width" PML_value="cgi.mpoint_width" />
					<input type="hidden" name="mpoint_height" PML_value="cgi.mpoint_height" />
					<input type="hidden" name="sms_receipt" PML_value="cgi.sms_receipt" />
					<input type="hidden" name="email_receipt" PML_value="cgi.email_receipt" />
					<input type="hidden" name="email_url" PML_value="cgi.email_url" />
					<input type="hidden" name="accept_url" PML_value="cgi.accept_url" />
					<input type="hidden" name="mobile" PML_value="cgi.mobile" />
					<input type="hidden" name="price" PML_value="cgi.price" />
					<input type="hidden" name="card_width" PML_value="cgi.card_width" />
					<input type="hidden" name="card_height" PML_value="cgi.card_height" />
					<PML_SCRIPT>
					// Transfer Custom Variables
					foreach(i ; cgi)
					{
						if (string.substring(cgi[i], 0, 4) = 'var_')
						{
							out.put('<input type="hidden" name="client_vars_names_'@ i @'" value="'@ cgi[i] @'" />');
							out.put('<input type="hidden" name="client_vars_data_'@ i @'" value="'@ cgi[i-7] @'" />');
						}
					}
					</PML_SCRIPT>
				</div>
				<div>
					<span class="mPoint_Label"><PML_VAL>label_selected_card</PML_VAL>:</span>
					<table>
					<tr>
					<PML_SWITCH EXPR="cgi.cardid">
						<PML_CASE VALUE="1">
							<td><img src="images/amex.jpg" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- American Express -" /></td>
							<td colspan="3" class="status">&nbsp;American Express</td>
						</PML_CASE>
						<PML_CASE VALUE="2">
							<td><img src="images/dankort.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Dankort -" /></td>
							<td colspan="3" class="status">&nbsp;Dankort</td>
						</PML_CASE>
						<PML_CASE VALUE="3">
							<td><img src="images/diners.jpg" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Diners Club -" /></td>
							<td colspan="3" class="status">&nbsp;Diners Club</td>
						</PML_CASE>
						<PML_CASE VALUE="4">
							<td><img src="images/mastercard.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- EuroCard -" /></td>
							<td colspan="3" class="status">&nbsp;EuroCard</td>
						</PML_CASE>
						<PML_CASE VALUE="5">
							<td><img src="images/jcb.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- JCB -" /></td>
							<td colspan="3" class="status">&nbsp;JCB</td>
						</PML_CASE>
						<PML_CASE VALUE="6">
							<td><img src="images/maestro.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Maestro -" /></td>
							<td colspan="3" class="status">&nbsp;Maestro</td>
						</PML_CASE>
						<PML_CASE VALUE="7">
							<td><img src="images/mastercard.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- MasterCard -" /></td>
							<td colspan="3" class="status">&nbsp;MasterCard</td>
						</PML_CASE>
						<PML_CASE VALUE="8">
							<td><img src="images/visa.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- VISA -" /></td>
							<td colspan="3" class="status">&nbsp;VISA</td>
						</PML_CASE>
						<PML_CASE VALUE="9">
							<td><img src="images/visa_electron.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- VISA Electron -" /></td>
							<td colspan="3" class="status">&nbsp;VISA Electron</td>
						</PML_CASE>
					</PML_SWITCH>
					</tr>
					</table>
				</div>
				<!-- Price -->
				<div id="price">
					<span class="mPoint_Label"><PML_VAL>label_price</PML_VAL>:</span>
					<PML_VAL>cgi.price</PML_VAL>
				</div>
				<!-- Credit Card Information -->
				<div class="mPoint_Help"><PML_VAL>info</PML_VAL></div>
				<div id="cardinfo">
					<div class="mPoint_Label">
						<PML_VAL>label_card_number</PML_VAL>:<br />
						<PML_IF COND="sess_cardno > 0">
							<input name="cardno" type="number" maxlength="19" PML_value="string.precision(sess_cardno, 0)" size="21" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
						</PML_IF>
						<PML_ELSE>
							<input name="cardno" type="number" maxlength="19" value="" size="21" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
						</PML_ELSE>
					</div>
					<div class="mPoint_Label">
						<PML_VAL>label_expiry</PML_VAL> <span class="mPoint_Info">(<PML_VAL>expiry_month</PML_VAL>/<PML_VAL>expiry_year</PML_VAL>)</span>:<br />
						<PML_IF COND="sess_expmon > 0">
							<input name="expmon" type="number" maxlength="2" PML_value="string.precision(sess_expmon, 0)" size="3" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
						</PML_IF>
						<PML_ELSE>
							<input name="expmon" type="number" maxlength="2" value="" size="3" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" />
						</PML_ELSE>
						&nbsp;/&nbsp;
						<PML_IF COND="sess_expyear > 0">
							<input name="expyear" type="number" maxlength="2" PML_value="string.precision(sess_expyear, 0)" size="3" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
						</PML_IF>
						<PML_ELSE>
							<input name="expyear" type="number" maxlength="2" value="" size="3" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
						</PML_ELSE>
					</div>
					<div class="mPoint_Label">
						<PML_VAL>label_cvc</PML_VAL>:<br />
						<PML_IF COND="sess_cvc > 0">
							<input name="cvc" type="number" maxlength="3" PML_value="string.precision(sess_cvc, 0)" size="4" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
						</PML_IF>
						<PML_ELSE>
							<input name="cvc" type="number" maxlength="3" value="" size="4" style="-wap-input-format:'*N';" onblur="javascript:parent.postMessage('reposition', '*');" pattern="[0-9]*" />
						</PML_ELSE>
					</div>
					<div class="mPoint_Info"><PML_VAL>cvc_help</PML_VAL></div>
				</div>
				<!-- Store Credit Card -->
				<PML_IF COND="cgi.store_card > 0">
					<div>
						<PML_IF COND="cgi.auto_store_card = 'true'">
							<input type="checkbox" name="preauth" value="true" checked="true" />
						</PML_IF>
						<PML_ELSE>
							<input type="checkbox" name="preauth" value="true" />
						</PML_ELSE>
						<PML_VAL>label_store</PML_VAL>
					</div>
				</PML_IF>
				<!-- Complete Payment -->
				<div id="submit">
					<input id="complete-payment" type="submit" PML_value="submit" class="mPoint_Button" />
				</div>
			</form>
		</div>
	</div>
</body>
</html>
</PML_DEFAULT>
</PML_SWITCH>
