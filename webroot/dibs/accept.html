<PML_META nospace="true">
<PML_SCRIPT>
/**
 * Page providing customers with the status of their payment transaction.
 * The page is translated into several languages as defined by mPoint and depending on the client's mPoint configuration,
 * some texts will be rendered dynamically to extend the information provided to the customer.
 *
 * @author Jonatan Evald Buus
 * @package Payment
 * @subpackage DIBS
 * @license Cellpoint Mobile
 */
 
/* ========== Language Translataion Start ========== */
switch(cgi.language)
{
	// Danish
	case ('da')
	{
		title_payment_completed := 'Betaling gennemført';
		title_create_account := 'Opret konto';
		title_save_card := 'Gem kort';
		mpoint := 'Tak fordi du brugte';
		status := 'Din betaling er gennemført';
		label_selected_card := 'Valgte kort';
		label_mpoint_id := 'mPoint ID';
		label_order_no := 'Ordrenr.';
		label_price := 'Pris';
		label_password := 'Kodeord';
		label_repeat := 'Gentag kodeord';
		label_card_name := 'Kortnavn';
		card_name_help := 'F.eks. "privat" eller "firma"';
		create_account_info := 'Udfyld nedenstående for at sætte kodeordet til din konto';
		save_card_info := 'Skriv navnet på det gemte kort';
		sms_receipt := 'Ovenstående kvittering er også blevet sendt via SMS til: MOBILE';
		email_receipt := 'Send kvittering via e-mail';
		save := 'Gem';
		continue := 'Fortsæt tilbage til sælgers site >>';
		resume := 'Genoptag betaling >>';
	}
	// Swedish
	case ('sv')
	{
		title_payment_completed := 'Betalningen genomförd';
		title_create_account := 'Create Account';
		title_save_card := 'Save Card';
		mpoint := 'Tack för att du använder';
		status := 'Din betalning har genomförts';
		label_selected_card := 'Valt kort';
		label_mpoint_id := 'mPoint ID';
		label_order_no := 'Order Nr';
		label_price := 'Pris';
		label_password := 'Password';
		label_repeat := 'Repeat password';
		label_card_name := 'Card name';
		card_name_help := 'F.ex. "private" or "company" (optional)';
		create_account_info := 'Please complete the form below to set the password for your account';
		save_card_info := 'Please enter a name for the stored card below?';
		sms_receipt := 'Denna information har även skickats till dig via ett SMS till nummer: MOBILE';
		email_receipt := 'Skicka kvitto via epost';
		save := 'Gem';
		continue := 'Återvänd till försäljarens webbplats >>';
		resume := 'Resume Payment >>';
	}
	// British English
	default
	{
		title_payment_completed := 'Payment Completed';
		title_create_account := 'Create Account';
		mpoint := 'Thank you for using';
		status := 'Your payment has been successfully completed';
		label_selected_card := 'Selected Card';
		label_mpoint_id := 'mPoint ID';
		label_order_no := 'Order No';
		label_price := 'Price';
		label_password := 'Password';
		label_repeat := 'Repeat password';
		label_card_name := 'Card name';
		card_name_help := 'F.ex. "private" or "company" (optional)';
		create_account_info := 'Please complete the form below to set the password for your account';
		save_card_info := 'Please enter a name for the stored card below?';
		sms_receipt := 'These details have also been sent to you via SMS to number: MOBILE';
		email_receipt := 'Send receipt via E-Mail';
		save := 'Save';
		continue := 'Continue back to Merchant Site >>';
		resume := 'Resume Payment >>';
	}
}
/* ========== Language Translataion End ========== */

/* ========== App Specific Customizations Start ========== */
// DSB WildCard
if (cgi.accountid = 100020 || cgi.accountid = 100021)
{
	background_color := 'transparent';
	border_color := '#7f5ca9';
	text_color := '#fff';
}
// DSB Ticket
else
{
	background_color := '#eef2f0';
	border_color := '#80C435';
	text_color := '#000';
}
/* ========== App Specific Customizations End ========== */
</PML_SCRIPT>
<PML_IF COND="cgi.accountid = 100007">
	<?xml version="1.0" encoding="UTF-8"?>
	<root>
		<PML_IF COND="cgi.capturenow = 'true'">
			<status code="2001">Payment Captured</status>
		</PML_IF>
		<PML_ELSE>
			<status code="2000">Payment Authorized</status>
		</PML_ELSE>
	</root>
</PML_IF>
<PML_ELSE>
	<?xml version="1.0" encoding="ISO-8859-15"?>
	<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.openmobilealliance.org/DTD/xhtml-mobile10.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml" PML_xml:lang="cgi.lang">
	<head>
		<title>
			<PML_IF COND="cgi.preauth = 'true' && cgi.euaid < 0">
				<PML_VAL>title_create_account</PML_VAL>
			</PML_IF>
			<PML_ELSIF COND="cgi.preauth = 'true'">
				<PML_VAL>title_save_card</PML_VAL>
			</PML_ELSIF>
			<PML_ELSE>
				<PML_VAL>title_payment_completed</PML_VAL>
			</PML_ELSE>
		</title>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-15" />
		<meta http-equiv="Cache-Control" content="max-age=86400" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<style type="text/css">
			/* ========== Tag Classes Start ========== */
			body
			{
				margin: 5px 5px 5px 5px;
			}
			body, table
			{
				background-color: <PML_VAL>background_color</PML_VAL>;
				text-align: left;
			}
			body, table, div
			{
				font-size: 1em;
				font-family: "Trebuchet MS",arial,sans-serif;
				color: <PML_VAL>text_color</PML_VAL>;
			}
			
			h1
			{
				font-size: 130%;
				white-space: nowrap;
				text-align: center;
				color: <PML_VAL>text_color</PML_VAL>;
			}
			
			form, table
			{
				margin: 0px 0px 0px 0px;
				padding: 0px 0px 0px 0px;
			}
			
			a
			{
				color: blue;
				text-decoration: none;
			}
			
			a:hover
			{
				text-decoration: underline;
			}
			
			input.number
			{
				-wap-input-format: '*N';
			}
			ul, ul li
			{
				padding: 0;
				margin: 0;
			}
			ul li
			{
				margin-left: 1em;
			}
			/* ========== Tag Classes End ========== */
			
			/* ========== mPoint Classes Start ========== */
			.mPoint_Label
			{
				font-weight: bold;
				padding-right: 0.5em;
				padding-top: 0.3em;
				white-space: nowrap;
			}
			
			.mPoint_Info
			{
				font-weight: normal;
				color: <PML_VAL>text_color</PML_VAL>;
				text-align: left;
				padding: 0px;
				margin: 0px;	
			}
			
			.mPoint_Help
			{
				margin-left: 15px;
			}
			
			.mPoint_Status
			{
				margin-left: 10px;
				font-size: 90%;
				color: red;
				font-style: italic;
				padding-top: 0.5em;
				padding-bottom: 0.5em;
			}
			
			td.mPoint_Number
			{
				padding-right: 0.5em;
				text-align: right;
				vertical-align: bottom;
				white-space: nowrap;
			}
			
			tr.mPoint_Even, div.mPoint_Even
			{
				color: <PML_VAL>text_color</PML_VAL>;
			}
			input.mPoint_Even_Card_Button
			{
				border-width: 0px;
				border-style: none;
				border-color: #fff;
				color: <PML_VAL>text_color</PML_VAL>;
				text-decoration: underline;
				margin: 0px 0px 0px 0px;
				padding: 0px 0px 2px 0px;
			}
			tr.mPoint_Uneven, div.mPoint_Uneven
			{
				background-color: <PML_VAL>background_color</PML_VAL>;
			}
			input.mPoint_Uneven_Card_Button
			{
				border-width: 0px;
				border-style: none;
				border-color: <PML_VAL>border_color</PML_VAL>;
				color: #fff;
				text-decoration: underline;
				margin: 0px 0px 0px 0px;
				padding: 0px 0px 2px 0px;
			}
			
			input.mPoint_Button
			{
				font-size: 1em;
				font-weight: bold;
				color: #000;
			}
			input.mPoint_Card_Button
			{
				font-size: 1em;
				border-width: 0px;
				border-style: none;
				border-color: #fff;
				color: blue;
				text-decoration: underline;
				margin: 0px 0px 0px 0px;
				padding: 0px 0px 2px 0px;
			}
			input.mPoint_Card_Button:hover
			{
				cursor: pointer; cursor: hand;
			}
			
			div.mPoint_Card
			{
			}
			
			div.mPoint_Account
			{
				width: 100%;
			}
			div.mPoint_Account
			{
				width: 100%;
				border-bottom-style: dashed;
				border-color: <PML_VAL>border_color</PML_VAL>;
				border-width: 2px;
			}
			div.mPoint_Account input.mPoint_Card_Button
			{
				color: <PML_VAL>text_color</PML_VAL>;
				font-weight: bold;
			}
			/* ========== mPoint Classes Start ========== */
			
			/* ========== ID Classes Start ========== */
			table#products tr td
			{
				padding-left: 3px;
				padding-top: 3px;
			}
			
			table#receipt, div#top-up div.mPoint_Info
			{
				margin-top: 0.5em;
				margin-bottom: 0.5em;
			}
			table#receipt, table#products tr.mPoint_Uneven
			{
				color: <PML_VAL>text_color</PML_VAL>;
			}
			
			div#logo, div#progress, div#mPoint, div#status, div#top-up div#close
			{
				text-align: center;
			}
			div#logo
			{
				margin-right: 5px;
			}
			
			div#status table tr td
			{
				vertical-align: middle;
				padding-left: 0.5em;
			}
			
			div#terms
			{
				white-space: pre;
			}
			
			div#delivery, div#email, div#cardinfo, div#prepaid, div#accountinfo, div#my-account table
			{
	
			}
			div#delivery, div#email, div#cardinfo, div#prepaid, div#accountinfo
			{
				padding-left: 3px;
				padding-bottom: 3px;
			}
			
			div#shipping div table tr td
			{
				padding-top: 3px;
				padding-left: 3px;
			}
			
			div#cards, div#cardinfo, div#accountinfo, table#receipt
			{
				padding: 0px 10px 0px 10px;
				border: solid <PML_VAL>border_color</PML_VAL> 2px;
				-moz-border-radius: 10px;
				-webkit-border-radius: 10px;
				border-radius: 10px;
			}
			
			div#my-account
			{
			}
			div#my-account div#prepaid div, div#my-account div#prepaid table, div#my-account div#cardinfo div, div#my-account div#cardinfo table, div#my-account div#cardinfo table * .mPoint_Info
			{
				color: <PML_VAL>text_color</PML_VAL>;
			}
			div#my-account .passive
			{
				color: #708090;
			}
			div#my-account a#top-up
			{
				color: red;
			}
			div#my-account div#cardinfo, div#my-account div#accountinfo, div#email
			{
				margin-bottom: 5px;
			}
			div#my-account div#password
			{
				padding-bottom: 5px;
				border-top-style: dashed;
				border-color: <PML_VAL>border_color</PML_VAL>;
				border-width: 2px;
			}
			
			div#price
			{
				margin-left: 15px;
				padding-bottom: 0.5em;
			}
			div#outer-border
			{
				
			}
			div#info div#submit
			{
				margin-left: 0px;
			}
			div#info, div#submit, div#link, div#selected-card, div#store-card
			{
				margin-left: 10px;
			}
			/* ========== ID Classes End ========== */
		</style>
	</head>
	<body>
		<!-- Create New Account -->
		<PML_IF COND="cgi.preauth = 'true' && cgi.euaid < 0">
			<div id="my-account">
				<div id="selected-card">
					<span class="mPoint_Label"><PML_VAL>label_selected_card</PML_VAL>:</span>
					<table>
					<tr>
					<PML_SWITCH EXPR="cgi.cardid">
						<PML_CASE VALUE="1">
							<td><img src="images/amex.jpg" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- American Express -" /></td>
							<td colspan="3" class="status">&nbsp;American Express</td>
						</PML_CASE>
						<PML_CASE VALUE="2">
							<td><img src="images/dankort.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Dankort -" /></td>
							<td colspan="3" class="status">&nbsp;Dankort</td>
						</PML_CASE>
						<PML_CASE VALUE="3">
							<td><img src="images/diners.jpg" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Diners Club -" /></td>
							<td colspan="3" class="status">&nbsp;Diners Club</td>
						</PML_CASE>
						<PML_CASE VALUE="4">
							<td><img src="images/mastercard.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- EuroCard -" /></td>
							<td colspan="3" class="status">&nbsp;EuroCard</td>
						</PML_CASE>
						<PML_CASE VALUE="5">
							<td><img src="images/jcb.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- JCB -" /></td>
							<td colspan="3" class="status">&nbsp;JCB</td>
						</PML_CASE>
						<PML_CASE VALUE="6">
							<td><img src="images/maestro.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Maestro -" /></td>
							<td colspan="3" class="status">&nbsp;Maestro</td>
						</PML_CASE>
						<PML_CASE VALUE="7">
							<td><img src="images/mastercard.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- MasterCard -" /></td>
							<td colspan="3" class="status">&nbsp;MasterCard</td>
						</PML_CASE>
						<PML_CASE VALUE="8">
							<td><img src="images/visa.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- VISA -" /></td>
							<td colspan="3" class="status">&nbsp;VISA</td>
						</PML_CASE>
						<PML_CASE VALUE="9">
							<td><img src="images/visa_electron.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- VISA Electron -" /></td>
							<td colspan="3" class="status">&nbsp;VISA Electron</td>
						</PML_CASE>
					</PML_SWITCH>
					</tr>
					</table>
				</div>
				<div id="outer-border">
					<form PML_action="string.replace(cgi.callbackurl, '/callback/dibs.php', '') @'/pay/sys/save_pwd.php?PHPSESSID='@cgi.PHPSESSID" method="post">
						<div>
							<!-- Standard mPoint Variables -->
							<input type="hidden" name="cardid" PML_value="cgi.cardid" />
							<input type="hidden" name="card_width" PML_value="cgi.card_width" />
							<input type="hidden" name="card_height" PML_value="cgi.card_height" />
						</div>
						<div class="mPoint_Help"><PML_VAL>create_account_info</PML_VAL></div>
						<div id="accountinfo">
							<!-- Password Info -->
							<div class="mPoint_Label">
								<PML_VAL>label_password</PML_VAL>:<br />
								<input type="password" name="pwd" value="" />
							</div>
							<!-- Repeat Password -->
							<div class="mPoint_Label">
								<PML_VAL>label_repeat</PML_VAL>:<br />
								<input type="password" name="rpt" value="" />
							</div>
							<!-- Card Name -->
							<div class="mPoint_Label">
								<PML_VAL>label_card_name</PML_VAL>:<br />
								<input type="text" name="name" value="" maxlength="50" />
							</div>
							<div class="mPoint_Info"><PML_VAL>card_name_help</PML_VAL></div>
						</div>		
						<div id="submit" style="text-align:center">
							<input type="submit" PML_value="save" class="mPoint_Button" />
						</div>
					</form>
				</div>
			</div>
		</PML_IF>
		<PML_ELSIF COND="cgi.preauth = 'true'">
			<div id="my-account">
				<div id="selected-card">
					<span class="mPoint_Label"><PML_VAL>label_selected_card</PML_VAL>:</span>
					<table>
					<tr>
					<PML_SWITCH EXPR="cgi.cardid">
						<PML_CASE VALUE="1">
							<td><img src="images/amex.jpg" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- American Express -" /></td>
							<td colspan="3" class="status">&nbsp;American Express</td>
						</PML_CASE>
						<PML_CASE VALUE="2">
							<td><img src="images/dankort.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Dankort -" /></td>
							<td colspan="3" class="status">&nbsp;Dankort</td>
						</PML_CASE>
						<PML_CASE VALUE="3">
							<td><img src="images/diners.jpg" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Diners Club -" /></td>
							<td colspan="3" class="status">&nbsp;Diners Club</td>
						</PML_CASE>
						<PML_CASE VALUE="4">
							<td><img src="images/mastercard.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- EuroCard -" /></td>
							<td colspan="3" class="status">&nbsp;EuroCard</td>
						</PML_CASE>
						<PML_CASE VALUE="5">
							<td><img src="images/jcb.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- JCB -" /></td>
							<td colspan="3" class="status">&nbsp;JCB</td>
						</PML_CASE>
						<PML_CASE VALUE="6">
							<td><img src="images/maestro.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- Maestro -" /></td>
							<td colspan="3" class="status">&nbsp;Maestro</td>
						</PML_CASE>
						<PML_CASE VALUE="7">
							<td><img src="images/mastercard.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- MasterCard -" /></td>
							<td colspan="3" class="status">&nbsp;MasterCard</td>
						</PML_CASE>
						<PML_CASE VALUE="8">
							<td><img src="images/visa.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- VISA -" /></td>
							<td colspan="3" class="status">&nbsp;VISA</td>
						</PML_CASE>
						<PML_CASE VALUE="9">
							<td><img src="images/visa_electron.gif" PML_width="cgi.card_width" PML_height="cgi.card_height" alt="- VISA Electron -" /></td>
							<td colspan="3" class="status">&nbsp;VISA Electron</td>
						</PML_CASE>
					</PML_SWITCH>
					</tr>
					</table>
				</div>
				<div id="outer-border">
					<form PML_action="string.replace(cgi.callbackurl, '/callback/dibs.php', '') @'/pay/sys/save_name.php?PHPSESSID='@cgi.PHPSESSID" method="post">
						<div>
							<!-- Standard mPoint Variables -->
							<input type="hidden" name="cardid" PML_value="cgi.cardid" />
							<input type="hidden" name="card_width" PML_value="cgi.card_width" />
							<input type="hidden" name="card_height" PML_value="cgi.card_height" />
						</div>
						<div class="mPoint_Help"><PML_VAL>save_card_info</PML_VAL></div>
						<div id="accountinfo">
							<!-- Card Name -->
							<div class="mPoint_Label">
								<PML_VAL>label_card_name</PML_VAL>:<br />
								<input type="text" name="name" value="" maxlength="50" />
							</div>
							<div class="mPoint_Info"><PML_VAL>card_name_help</PML_VAL></div>
						</div>		
						<div id="submit" style="text-align:center">
							<input type="submit" PML_value="save" class="mPoint_Button" />
						</div>
					</form>
				</div>
			</div>
		</PML_ELSIF>
		<PML_ELSE>
			<!-- Payment Completed -->
			<h1>
				<PML_VAL>mpoint</PML_VAL><br />
				<img src="images/mpoint_logo.gif" PML_width="cgi.mpoint_width" PML_height="cgi.mpoint_height" alt="- mPoint -" />
			</h1>
			<div id="status">
				<!--
				  - The colspan attribute in the table below ensures that the page is rendered correctly on the Nokia 6230.
				  - Nokia 6230 assigns the same width to all table columns but by using the colspan attribute (eventhough it really isn't needed)
				  - the phone will assign 33% of the screen width to the "OK Image" and 66% of the screen width to the "OK Text"
				  -->
				<table>
				<tr>
					<td><img src="images/success.gif" width="30" height="28" alt="- OK - " /></td>
					<td colspan="2" class="mPoint_Info"><PML_VAL>status</PML_VAL></td>
				</tr>
				</table>
			</div>
			
			<table id="receipt">
			<tr>
				<td class="mPoint_Label"><PML_VAL>label_mpoint_id</PML_VAL>:</td>
				<td class="mPoint_Number"><PML_VAL>cgi.mpointid</PML_VAL></td>
				<td rowspan="3" style="width:40%;"></td>
			</tr>
			<!-- Order Number Provided -->
			<PML_IF COND="string.length(cgi.orderid) > 0">
				<tr>
					<td class="mPoint_Label"><PML_VAL>label_order_no</PML_VAL>:</td>
					<td class="mPoint_Number"><PML_VAL>cgi.orderid</PML_VAL></td>
				</tr>
			</PML_IF>
			<tr>
				<td class="mPoint_Label"><PML_VAL>label_price</PML_VAL>:</td>
				<td class="mPoint_Number"><PML_VAL>cgi.price</PML_VAL></td>
			</tr>
			</table>
			
			<!-- SMS Receipt Enabled -->
			<PML_IF COND="cgi.sms_receipt = 'true'">
				<div class="mPoint_Info">
					<PML_VAL>string.replace(sms_receipt, 'MOBILE', cgi.mobile, 'g')</PML_VAL>
				</div>
			</PML_IF>
			<!-- E-Mail Receipt Enabled -->
			<PML_IF COND="cgi.email_receipt = 'true'">
				<div>
					<a PML_href="'http://mpoint.cellpointmobile.com/pay/email.php?PHPSESSID='@cgi.PHPSESSID"><PML_VAL>email_receipt</PML_VAL></a>
				</div>
			</PML_IF>
			
			<!-- Current transaction is an Account Top-Up and a previous transaction is in progress -->
			<PML_IF COND="cgi.org_mpointid > 0">
				<div>
					<form PML_action="'http://mpoint.cellpointmobile.com/cpm/payment.php?PHPSESSID='@ cgi.PHPSESSID @'&msg=1'" method="post">
						<p>
							<input type="hidden" name="resume" value="true" />
						</p>
						<p>
							<input type="submit" PML_value="resume" class="mPoint_Button" />
						</p>
					</form>
				</div>
			</PML_IF>
			<PML_ELSIF COND="string.length(cgi.accept_url) > 0">
				<!-- Client has specified a return URL for successful payments -->
				<div>
					<form PML_action="cgi.accept_url" method="post">
						<div>
							<!-- Standard mPoint Variables -->
							<input type="hidden" name="mpoint-id" PML_value="cgi.mpointid" />
							<input type="hidden" name="orderid" PML_value="cgi.orderid" />
							<input type="hidden" name="status" value="2000" />
							<input type="hidden" name="amount" PML_value="cgi.amount" />
							<input type="hidden" name="currency" PML_value="cgi.currency" />
							<input type="hidden" name="mobile" PML_value="cgi.mobile" />
							<input type="hidden" name="operator" PML_value="cgi.operator" />
							<!-- Custom Client Variables -->
							<PML_SCRIPT>
							// Transfer Custom Variables
							foreach(i ; cgi)
							{
								if (string.substring(cgi[i], 0, 4) = 'var_')
								{
									out.put('<input type="hidden" name="'@ cgi[i] @'" value="'@ cgi[i-7] @'" />');
								}
							}
							</PML_SCRIPT>
						</div>
						<div id="submit">
							<input type="submit" PML_value="continue" class="mPoint_Button" />
						</div>
					</form>
				</div>
			</PML_ELSIF>
		</PML_ELSE>
	</body>
	</html>
</PML_ELSE>